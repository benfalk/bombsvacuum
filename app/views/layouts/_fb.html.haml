- if user_signed_in?
  #fb-root
  :javascript
    window.fbAsyncInit = function() {
      // init the FB JS SDK
      FB.init({
        appId      : '153133848208607',
        status     : true,
        xfbml      : true
      });

      FB.getLoginStatus(function(response) {
        if (response.status === 'connected') {
          FB.api('/fql', {q: 'SELECT uid, name, pic_square FROM user WHERE is_app_user = 0 AND uid IN ( SELECT uid2 FROM friend WHERE uid1 = me() ) LIMIT 21'}, function(response){
            var s = $("<select id=\"selectId\" name=\"selectName\" class=\"chzn-select\" />");
            $("<option />", {value: '', text: 'Select a friend to Challenge'}).appendTo(s);
            $.each(response.data, function() {
              $("<option />", {value: this.id, text: this.name}).appendTo(s);
              $('#facebookFriends').append('<div data-tooltip class="facebook-square tip-left" style="background: url(\''+this.pic_square+'\')" title="'+this.name+'"></div>');
            });
            s.appendTo($('#facebookFriendsSelect'));
            $('.chzn-select').chosen({allow_single_deselect: true, no_results_text: 'No results matched', width: '280px'})
            $('.chzn-select').css({'font-size':'50px'});
          });
        }
      });
    };

    // Load the SDK asynchronously
    (function(d, s, id){
       var js, fjs = d.getElementsByTagName(s)[0];
       if (d.getElementById(id)) {return;}
       js = d.createElement(s); js.id = id;
       js.src = "//connect.facebook.net/en_US/all.js";
       fjs.parentNode.insertBefore(js, fjs);
     }(document, 'script', 'facebook-jssdk'));

  #challenge.reveal-modal.small
    %i.icon-facebook-sign{style:'font-size:100px;color:#3b5998;'}
    %h2 Challenge a friend!
    #facebookFriendsSelect
    %br
    Top challengers
    %br
    #facebookFriends
    %a.close-reveal-modal ×
- else
  #challenge.reveal-modal.small
    %i.icon-facebook-sign{style:'font-size:100px;color:#3b5998;'}
    %h2 Challenge a friend!
    %br
    = link_to 'Sign in with Facebook', '/users/auth/facebook'
    %a.close-reveal-modal ×